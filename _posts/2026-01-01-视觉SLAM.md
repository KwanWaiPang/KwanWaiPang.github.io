---
layout: post
title: "视觉SLAM"
date:   2026-01-01
tags: [SLAM]
comments: true
author: kwanwaipang
toc: false
excerpt: "" 
---

* [原博客](https://kwanwaipang.github.io/File/Blogs/Poster/%E8%A7%86%E8%A7%89SLAM.html)

<div id="target-content-placeholder">正在加载内容及目录...</div>

<script>
(function() {
  if (window.__SLAM_BLOG_LOADED__) return;
  window.__SLAM_BLOG_LOADED__ = true;

  const baseUrl = '/File/Blogs/Poster/'; 
  const filePath = baseUrl + '视觉SLAM.html';
  const target = document.getElementById('target-content-placeholder');

  fetch(filePath)
    .then(res => res.text())
    .then(html => {
      const parser = new DOMParser();
      const doc = parser.parseFromString(html, 'text/html');

      // 移除干扰元素（保持你原来的逻辑）
      const toRemove = ['header', '.navbar', '.post-header', 'footer'];
      toRemove.forEach(s => doc.querySelectorAll(s).forEach(el => el.remove()));

      // 路径转换
      const rawBody = doc.body.innerHTML;
      const processedHtml = rawBody.replace(/(src|href)="(?!(http|https|\/|#))/g, `$1="${baseUrl}`);

      // 样式提取
      let styleContent = '';
      doc.querySelectorAll('style, link[rel="stylesheet"]').forEach(s => {
        if (s.tagName === 'LINK') {
          let href = s.getAttribute('href');
          if (href && !href.startsWith('http') && !href.startsWith('/')) s.setAttribute('href', baseUrl + href);
        }
        styleContent += s.outerHTML;
      });

      // 渲染 Shadow DOM
      const shadow = target.attachShadow({ mode: 'open' });
      shadow.innerHTML = styleContent + processedHtml;

      // --- 核心修复：手动生成目录 ---
      // 等待 DOM 渲染后执行
      setTimeout(() => {
        // 1. 在 Shadow DOM 内部查找所有的标题
        const headings = shadow.querySelectorAll('h1, h2, h3');
        // 2. 在 Shadow DOM 内部查找你原本定义的目录容器 (#toc 和 #newToc)
        const shadowToc = shadow.querySelector('#toc ul');
        const shadowNewToc = shadow.querySelector('#newToc ul');

        if (headings.length > 0) {
          headings.forEach((h, index) => {
            // 为标题添加 ID 方便跳转
            const anchorId = 'heading-' + index;
            h.id = anchorId;

            // 创建目录项
            const li = document.createElement('li');
            li.style.listStyle = "none";
            li.style.paddingLeft = (parseInt(h.tagName[1]) - 1) * 15 + 'px';
            
            const a = document.createElement('a');
            a.innerText = h.innerText;
            a.href = "#";
            a.style.cursor = "pointer";
            a.style.color = "#007bff";
            a.style.textDecoration = "none";
            
            // 点击目录项，滚动 Shadow DOM 内部的标题
            a.onclick = (e) => {
              e.preventDefault();
              h.scrollIntoView({ behavior: 'smooth', block: 'start' });
            };

            li.appendChild(a);
            if (shadowToc) shadowToc.appendChild(li.cloneNode(true));
            if (shadowNewToc) {
               // 为悬浮目录也增加点击事件
               const newLi = li.cloneNode(true);
               newLi.querySelector('a').onclick = (e) => {
                 e.preventDefault();
                 h.scrollIntoView({ behavior: 'smooth', block: 'start' });
               };
               shadowNewToc.appendChild(newLi);
            }
          });
        }

        // 3. 重新绑定原本 HTML 里的按钮逻辑（因为原脚本在 Shadow DOM 里不自动运行）
        const toggleBtn = shadow.querySelector('#toggleTocButton');
        const newTocDiv = shadow.querySelector('#newToc');
        if (toggleBtn && newTocDiv) {
          toggleBtn.onclick = () => {
            const isVisible = newTocDiv.style.display === 'block';
            newTocDiv.style.display = isVisible ? 'none' : 'block';
          };
        }

        const scrollBtn = shadow.querySelector('#scrollToTocButton');
        const tocDiv = shadow.querySelector('#toc');
        if (scrollBtn && tocDiv) {
          scrollBtn.onclick = () => {
            tocDiv.scrollIntoView({ behavior: 'smooth' });
          };
        }
      }, 100);
    });
})();
</script>

<style>
/* 确保容器有足够宽度 */
#target-content-placeholder {
  width: 100%;
  display: block;
  min-height: 500px;
}
</style>