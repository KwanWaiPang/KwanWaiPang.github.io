---
layout: post
title: "è§†è§‰SLAM"
date:   2026-01-01
tags: [SLAM]
comments: true
author: kwanwaipang
toc: true
excerpt: "" 
---

* [åŸåšå®¢](https://kwanwaipang.github.io/File/Blogs/Poster/%E8%A7%86%E8%A7%89SLAM.html)

<div id="target-content-placeholder">æ­£åœ¨åŠ è½½å†…å®¹...</div>

<script>
(function() {
  if (window.__SLAM_BLOG_LOADED__) return;
  window.__SLAM_BLOG_LOADED__ = true;

  const baseUrl = '/File/Blogs/Poster/'; 
  const filePath = baseUrl + 'è§†è§‰SLAM.html';

  fetch(filePath)
    .then(res => res.text())
    .then(html => {
      const parser = new DOMParser();
      const doc = parser.parseFromString(html, 'text/html');

      // 1. ç§»é™¤åŸ HTML é‡Œçš„æ‰€æœ‰ UI ç»„ä»¶ï¼Œåªç•™çº¯å†…å®¹
      const toRemove = ['header', '.navbar', '.post-header', 'footer', '#toc', '#newToc', '#toggleTocButton', '#scrollToTocButton'];
      toRemove.forEach(s => doc.querySelectorAll(s).forEach(el => el.remove()));

      const rawBody = doc.body.innerHTML;
      const processedHtml = rawBody.replace(/(src|href)="(?!(http|https|\/|#))/g, `$1="${baseUrl}`);

      // 2. æå–å¹¶å¤„ç†æ ·å¼
      let styleContent = '';
      doc.querySelectorAll('style, link[rel="stylesheet"]').forEach(s => {
        if (s.tagName === 'LINK') {
            let href = s.getAttribute('href');
            if (href && !href.startsWith('http') && !href.startsWith('/')) s.setAttribute('href', baseUrl + href);
        }
        styleContent += s.outerHTML;
      });

      // 3. æ¸²æŸ“ Shadow DOM
      const target = document.getElementById('target-content-placeholder');
      const shadow = target.attachShadow({ mode: 'open' });
      shadow.innerHTML = styleContent + processedHtml;

      // 4. åŠ¨æ€å¡«å…… Jekyll åŸç”Ÿ TOC
      setTimeout(() => {
        // å®šä½ Jekyll ç”Ÿæˆçš„ç›®å½•å®¹å™¨ (å°è¯•å¸¸è§çš„å‡ ç§ ID)
        const jekyllToc = document.getElementById('markdown-toc') || 
                          document.querySelector('.toc-content') || 
                          document.querySelector('.post__toc');

        if (!jekyllToc) {
            console.warn("æœªæ‰¾åˆ° Jekyll ç›®å½•å®¹å™¨ï¼Œè¯·æ£€æŸ¥ä¸»é¢˜çš„ TOC å®¹å™¨ ID");
            return;
        }

        // æ¸…ç©º Jekyll è‡ªåŠ¨ç”Ÿæˆçš„ç©ºç›®å½•å†…å®¹
        jekyllToc.innerHTML = '';

        // ä» Shadow DOM è·å–æ‰€æœ‰æ ‡é¢˜ï¼ˆç¡®ä¿åŒ…æ‹¬ h1 ä¹Ÿå°±æ˜¯å¼•è¨€ï¼‰
        const headings = shadow.querySelectorAll('h1, h2, h3');
        
        if (headings.length > 0) {
          const ul = document.createElement('ul');
          ul.style.listStyle = "none";
          ul.style.paddingLeft = "0";

          headings.forEach((h, index) => {
            const id = `heading-ref-${index}`;
            h.id = id;

            const li = document.createElement('li');
            // æ ¹æ® H1, H2, H3 è®¾ç½®ä¸åŒçš„ç¼©è¿›
            const level = parseInt(h.tagName[1]);
            li.style.marginLeft = (level - 1) * 15 + "px";
            li.style.marginBottom = "5px";

            const a = document.createElement('a');
            a.innerText = h.innerText.replace('ğŸ˜Š', '').trim(); // ç§»é™¤å¯èƒ½çš„è¡¨æƒ…å¹²æ‰°
            a.href = "javascript:void(0);";
            a.style.textDecoration = "none";
            a.style.color = "inherit"; // ç»§æ‰¿ä¸»é¢˜é¢œè‰²
            
            // ç‚¹å‡»è·³è½¬é€»è¾‘
            a.onclick = (e) => {
              e.preventDefault();
              // è·å–æ ‡é¢˜ç›¸å¯¹äº shadow root çš„ä½ç½®å¹¶æ»šåŠ¨
              h.scrollIntoView({ behavior: 'smooth', block: 'start' });
            };

            li.appendChild(a);
            ul.appendChild(li);
          });
          jekyllToc.appendChild(ul);
        }
      }, 300); // ç•¥å¾®å»¶è¿Ÿç¡®ä¿ä¸»é¢˜è„šæœ¬å·²è¿è¡Œå®Œæ¯•
    });
})();
</script>

<style>
/* é’ˆå¯¹ Shadow DOM å®¹å™¨çš„å¾®è°ƒ */
#target-content-placeholder {
  display: block;
  width: 100%;
}
</style>