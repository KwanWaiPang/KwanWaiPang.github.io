---
layout: post
title: "视觉SLAM"
date:   2026-01-01
tags: [SLAM]
comments: true
author: kwanwaipang
toc: true
excerpt: ""
---

<div id="jekyll-toc-proxy"></div>

* [原博客](https://kwanwaipang.github.io/File/Blogs/Poster/%E8%A7%86%E8%A7%89SLAM.html)

<div id="target-content-placeholder">正在加载...</div>

<script>
(function() {
  if (window.__SLAM_BLOG_LOADED__) return;
  window.__SLAM_BLOG_LOADED__ = true;

  const baseUrl = '/File/Blogs/Poster/'; 
  const filePath = baseUrl + '视觉SLAM.html';

  fetch(filePath)
    .then(res => res.text())
    .then(html => {
      const parser = new DOMParser();
      const doc = parser.parseFromString(html, 'text/html');

      // 移除原 HTML 里的 UI 干扰，防止重复
      const toRemove = ['header', '.navbar', '.post-header', 'footer', '#scrollToTocButton', '#toggleTocButton', '#newToc'];
      toRemove.forEach(s => doc.querySelectorAll(s).forEach(el => el.remove()));

      const rawBody = doc.body.innerHTML;
      const processedHtml = rawBody.replace(/(src|href)="(?!(http|https|\/|#))/g, `$1="${baseUrl}`);

      // 提取样式
      let styleContent = '';
      doc.querySelectorAll('style, link[rel="stylesheet"]').forEach(s => {
        if (s.tagName === 'LINK') {
          let href = s.getAttribute('href');
          if (href && !href.startsWith('http') && !href.startsWith('/')) s.setAttribute('href', baseUrl + href);
        }
        styleContent += s.outerHTML;
      });

      // 渲染主内容
      const target = document.getElementById('target-content-placeholder');
      const shadow = target.attachShadow({ mode: 'open' });
      shadow.innerHTML = styleContent + processedHtml;

      // --- 关键：将标题同步到 Jekyll 的 TOC ---
      setTimeout(() => {
        // 尝试定位 Jekyll 主题生成的目录容器，通常是 #markdown-toc
        let jekyllToc = document.getElementById('markdown-toc') || 
                        document.querySelector('.toc') || 
                        document.getElementById('toc');
        
        // 如果都没找到，就用我们上面定义的代理容器
        if (!jekyllToc) jekyllToc = document.getElementById('jekyll-toc-proxy');

        const headings = shadow.querySelectorAll('h1, h2, h3');
        
        if (jekyllToc && headings.length > 0) {
          jekyllToc.innerHTML = '<p><strong>目录</strong></p>'; // 设置目录标题
          const ul = document.createElement('ul');
          
          headings.forEach((h, index) => {
            const id = `sec-${index}`;
            h.id = id;
            
            const li = document.createElement('li');
            li.className = `toc-entry toc-${h.tagName.toLowerCase()}`;
            
            const a = document.createElement('a');
            a.innerText = h.innerText;
            a.href = "javascript:void(0);";
            a.onclick = () => {
              h.scrollIntoView({ behavior: 'smooth', block: 'start' });
            };
            
            li.appendChild(a);
            ul.appendChild(li);
          });
          jekyllToc.appendChild(ul);
        }
      }, 200);
    });
})();
</script>

<style>
/* 样式修饰：让注入的目录符合 Jekyll 常见样式 */
#jekyll-toc-proxy ul {
    list-style: none;
    padding-left: 1.5rem;
    border-left: 2px solid #eee;
}
.toc-h1 { font-weight: bold; margin-top: 5px; }
.toc-h2 { margin-left: 15px; font-size: 0.9em; }
.toc-h3 { margin-left: 30px; font-size: 0.85em; color: #666; }
</style>